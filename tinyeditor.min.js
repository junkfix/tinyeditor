function spell(e){const l=e=>{e&&(e.style.display="block")},n=e=>{e&&(e.style.display="none")},a=e=>(e+="").split(" ").map((e=>(e=>(e+="")[0].toUpperCase()+e.slice(1))(e))).join(" "),s=e=>document.createElement(e),i=(e,t,l)=>e?void 0===l?e.getAttribute(t):void e.setAttribute(t,l):"";let o,r=null,c=(t,a=null,s)=>{if(o.focus(),"code"==t)return null!==r?(n(e),e.value!=r&&(o.innerHTML=e.value),l(o),r=null):(r=o.innerHTML,l(e),n(o)),void g.classList.toggle("code");document.execCommand("styleWithCSS",0,!0),document.execCommand(t,!1,a),f()},d=e=>/^https?:\//.test(e)?e:"http://"+e,p=(e,t,l=[],n=s(e))=>l.map((e=>e&&n.appendChild(e)))&&Object.assign(n,t),m=e=>p("input",{type:"color"}),u=(e,t)=>p("select",{},e.map((e=>p("option",{value:e,textContent:e>0?8+2*(e-1):a(e),style:t?'font-family:"'+e+'"':""})))),h={},f=e=>{for(let e in h)h[e].classList.toggle("selected",document.queryCommandState(e))},y=[[["bold"],["italic"],["underline"],["strikeThrough"],["justifyLeft"],["justifyCenter"]],[["fontName",u(["Arial","Arial Black","cursive","fantasy","Georgia","Impact","monospace","sans-serif","serif","Times","Verdana"],1)],["fontSize",u([1,2,3,4,5,6,7])],["forecolor",m()],["hilitecolor",m()]].map((([e,t])=>[e,0,Object.assign(t,{onchange:l=>c(e,t.value)})])),[["insertUnorderedList"],["insertOrderedList"],["insertHorizontalRule"]],[["createLink","link",d],["insertImage","image",d]].map((([e,l])=>[l,n=>(n=prompt("Enter the "+l+" URL"))&&c(e,t(n))])),[["undo"],["redo"],["removeFormat"],["code"]]],g=p("div",{className:"spell"});if(!(e=document.querySelector(e)))return;i(g,"style",i(e,"style")),g.appendChild(p("div",{className:"spell-bar"},y.map((e=>p("div",{className:"spell-zone"},e.map((([e,t=(t=>c(e)),l])=>h[e]=p("button",{className:"spell-icon",type:"button",title:a(e.replace(/([^a-z])/g," $1")),onclick:t},[p("i",{className:"icon-"+e.toLowerCase()}),l])))))))),o=p("div",{className:"spell-content",contentEditable:!0,onkeydown:e=>9!==e.which,onkeyup:f,onmouseup:f}),i(o,"placeholder",[i(e,"placeholder")].join("")),g.appendChild(o),e.parentNode.insertBefore(g,e),g.appendChild(e),n(e),o.innerHTML=e.value,"input keyup change paste".split(" ").forEach((t=>o.addEventListener(t,(()=>{e.value=o.innerHTML}))));const v="A,B,BLOCKQUOTE,BR,DEL,DIV,FONT,H1,H2,H3,HR,I,IMG,INS,LI,OL,P,S,SPAN,STRONG,SUB,SUP,TABLE,TBODY,TD,TH,THEAD,TR,U,UL".split(","),L="HEAD,LINK,META,SCRIPT,STYLE".split(","),T="align,alt,colspan,download,height,href,open,reversed,rowspan,sizes,span,src,srcset,start,style,valign,width".split(","),N=/^(min|max|font|text|list|background|color|width|height)\b/,b=",xx-small,x-small,small,medium,large,x-large,xx-large".split(","),C=e=>{e.replaceWith(...e.childNodes)},A=t=>{let l=0;for(let e=t.children.length-1;e>=0;e--){let n=t.children[e];if("FONT"==n.tagName){const e=s("span");for(const t of n.attributes){let l=t.name,n=t.value;"face"==l&&(l="fontFamily"),"size"==l&&(l="fontSize",n=b[n]),"style"==l?i(e,l,t.value):e.style[l]=n}Array.from(n.childNodes).forEach((t=>e.appendChild(t))),n.replaceWith(e),n=e}for(const e of n.attributes)if(T.includes(e.name)){if("style"==e.name){let e=0;for(let t=n.style.length-1;t>=0;t--){const l=n.style[t];e++,N.test(l)||(n.style.removeProperty(l),e--)}e||n.removeAttribute("style")}}else n.removeAttribute(e.name);!v.includes(n.tagName)||"IMG"===n.tagName&&i(n,"src").startsWith("data")?""===n.textContent||L.includes(n.tagName)?n.remove():(C(n),l=1):n.children.length&&A(n)}((e,t)=>Array.from((t||document).querySelectorAll(e)))("span",t).forEach((e=>{0===e.attributes.length&&C(e)})),e.value=o.innerHTML,l&&A(o)};return o.addEventListener("input",(e=>{let t=e.inputType;"insertFromDrop"!==t&&"insertFromPaste"!==t||A(o)})),o}
