function spell(e){const l=e=>{e&&(e.style.display="block")},n=e=>{e&&(e.style.display="none")},a=e=>(e+="").split(" ").map((e=>(e=>(e+="")[0].toUpperCase()+e.slice(1))(e))).join(" "),s=e=>document.createElement(e),i=(e,t,l)=>e?void 0===l?e.getAttribute(t):void e.setAttribute(t,l):"";let o,r=null;const c="style";let d=(t,a=null,s)=>{if(o.focus(),"code"==t)return null!==r?(n(e),e.value!=r&&(o.innerHTML=e.value),l(o),r=null):(r=o.innerHTML,l(e),n(o)),void v.classList.toggle("code");document.execCommand("styleWithCSS",0,!0),document.execCommand(t,!1,a),g()},p=e=>/^https?:\//.test(e)?e:"http://"+e,m=(e,t,l=[],n=s(e))=>l.map((e=>e&&n.appendChild(e)))&&Object.assign(n,t),u=e=>m("input",{type:"color"}),h=(e,t)=>m("select",{},e.map((e=>m("option",{value:e,textContent:e>0?8+2*(e-1):a(e),style:t?'font-family:"'+e+'"':""})))),f={},g=e=>{for(let e in f)f[e].classList.toggle("selected",document.queryCommandState(e))},y=[[["bold"],["italic"],["underline"],["strikeThrough"],["justifyLeft"],["justifyCenter"]],[["fontName",h(["Arial","Arial Black","cursive","fantasy","Georgia","Impact","monospace","sans-serif","serif","Times","Verdana"],1)],["fontSize",h([1,2,3,4,5,6,7])],["forecolor",u()],["hilitecolor",u()]].map((([e,t])=>[e,0,Object.assign(t,{onchange:l=>d(e,t.value)})])),[["insertUnorderedList"],["insertOrderedList"],["insertHorizontalRule"]],[["createLink","link",p],["insertImage","image",p]].map((([e,l])=>[l,n=>(n=prompt("Enter the "+l+" URL"))&&d(e,t(n))])),[["undo"],["redo"],["removeFormat"],["code"]]],v=m("div",{className:"spell"});if(!(e=document.querySelector(e)))return;i(v,c,i(e,c)),v.appendChild(m("div",{className:"spell-bar"},y.map((e=>m("div",{className:"spell-zone"},e.map((([e,t=(t=>d(e)),l])=>f[e]=m("button",{className:"spell-icon",type:"button",title:a(e.replace(/([^a-z])/g," $1")),onclick:t},[m("i",{className:"icon-"+e.toLowerCase()}),l])))))))),o=m("div",{className:"spell-content",contentEditable:!0,onkeydown:e=>9!==e.which,onkeyup:g,onmouseup:g}),i(o,"placeholder",[i(e,"placeholder")].join("")),v.appendChild(o),e.parentNode.insertBefore(v,e),v.appendChild(e),n(e),o.innerHTML=e.value,"input keyup change paste".split(" ").forEach((t=>o.addEventListener(t,(()=>{e.value=o.innerHTML}))));const L="A,B,BLOCKQUOTE,BR,DEL,DIV,EM,FONT,H1,H2,H3,HR,I,IMG,INS,LI,OL,P,S,SPAN,STRONG,SUB,SUP,TABLE,TBODY,TD,TH,THEAD,TR,U,UL".split(","),T="HEAD,LINK,META,SCRIPT,STYLE".split(","),N="align,alt,colspan,download,height,href,open,reversed,rowspan,sizes,span,src,srcset,start,style,valign,width".split(","),b=/^(min|max|font|text|list|background|color|width|height)\b/,C=",xx-small,x-small,small,medium,large,x-large,xx-large".split(","),A=e=>{e.replaceWith(...e.childNodes)},E=t=>{let l=0;for(let e=t.children.length-1;e>=0;e--){let n=t.children[e];if("FONT"==n.tagName){const e=s("span");i(e,c,i(n,c));for(const t of n.attributes){let l=t.name,n=t.value;["face","size","color"].includes(l)?("face"==l&&(l="fontFamily"),"size"==l&&(l="fontSize",n=C[n]),e.style[l]=n):l!=c&&i(e,l,t.value)}Array.from(n.childNodes).forEach((t=>e.appendChild(t))),n.replaceWith(e),n=e}for(const e of n.attributes)if(N.includes(e.name)){if(e.name==c){let e=0;for(let t=n.style.length-1;t>=0;t--){const l=n.style[t];e++,b.test(l)||(n.style.removeProperty(l),e--)}e||n.removeAttribute(c)}}else n.removeAttribute(e.name);!L.includes(n.tagName)||"IMG"===n.tagName&&i(n,"src").startsWith("data")?""===n.textContent||T.includes(n.tagName)?n.remove():(A(n),l=1):n.children.length&&E(n)}((e,t)=>Array.from((t||document).querySelectorAll(e)))("span",t).forEach((e=>{0===e.attributes.length&&A(e)})),e.value=o.innerHTML,l&&E(o)};return o.addEventListener("input",(e=>{let t=e.inputType;"insertFromDrop"!==t&&"insertFromPaste"!==t||E(o)})),o}
